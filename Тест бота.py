# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã
import telebot  # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram-–±–æ—Ç–æ–≤ (pyTelegramBotAPI)
import requests  # –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenWeather API
import time  # –î–ª—è –∑–∞–¥–µ—Ä–∂–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è webhook)
from datetime import datetime, timedelta  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ!)
TELEGRAM_TOKEN = "8408071612:AAGLGXap5PITGGFxCS9ilLadCzr5HBNxX0M"  # –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram-–±–æ—Ç–∞ –æ—Ç @BotFather
OPENWEATHER_API_KEY = "830c59b19e3968c7636dad1512feefb8"  # –ö–ª—é—á –æ—Ç OpenWeatherMap API

bot = telebot.TeleBot(TELEGRAM_TOKEN)  # –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞ —Å –≤–∞—à–∏–º —Ç–æ–∫–µ–Ω–æ–º

# –°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –≤—ã–±–æ—Ä–∞ (–†–æ—Å—Å–∏—è + –∫—Ä—É–ø–Ω—ã–µ –º–∏—Ä–æ–≤—ã–µ –≥–æ—Ä–æ–¥–∞)
CITIES = [
    "–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å",
    "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–°–∞–º–∞—Ä–∞", "–û–º—Å–∫", "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
    "–£—Ñ–∞", "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫", "–í–æ—Ä–æ–Ω–µ–∂", "–ü–µ—Ä–º—å", "–í–æ–ª–≥–æ–≥—Ä–∞–¥",
    "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–°–∞—Ä–∞—Ç–æ–≤", "–¢—é–º–µ–Ω—å", "–¢–æ–ª—å—è—Ç—Ç–∏", "–ò–∂–µ–≤—Å–∫",
    "–ë–∞—Ä–Ω–∞—É–ª", "–£–ª—å—è–Ω–æ–≤—Å–∫", "–ò—Ä–∫—É—Ç—Å–∫", "–•–∞–±–∞—Ä–æ–≤—Å–∫", "–Ø—Ä–æ—Å–ª–∞–≤–ª—å",
    "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫", "–ú–∞—Ö–∞—á–∫–∞–ª–∞", "–¢–æ–º—Å–∫", "–û—Ä–µ–Ω–±—É—Ä–≥", "–ö–µ–º–µ—Ä–æ–≤–æ",
    "–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫", "–†—è–∑–∞–Ω—å", "–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å", "–ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã", "–ü–µ–Ω–∑–∞",
    "–õ–∏–ø–µ—Ü–∫", "–ö–∏—Ä–æ–≤", "–ß–µ–±–æ–∫—Å–∞—Ä—ã", "–¢—É–ª–∞", "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥",
    "–ö—É—Ä—Å–∫", "–£–ª–∞–Ω-–£–¥—ç", "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å", "–°–æ—á–∏", "–¢–≤–µ—Ä—å",
    "–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫", "–ò–≤–∞–Ω–æ–≤–æ", "–ë—Ä—è–Ω—Å–∫", "–°—É—Ä–≥—É—Ç", "–ë–µ–ª–≥–æ—Ä–æ–¥",
    "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫", "–í–ª–∞–¥–∏–º–∏—Ä", "–ö—É—Ä–≥–∞–Ω", "–°–º–æ–ª–µ–Ω—Å–∫", "–ö–∞–ª—É–≥–∞",
    "–ß–∏—Ç–∞", "–°–∞—Ä–∞–Ω—Å–∫", "–ö–æ—Å—Ç—Ä–æ–º–∞", "–í–æ–ª–æ–≥–¥–∞", "–ü–µ—Ç—Ä–æ–∑–∞–≤–æ–¥—Å–∫",
    "–ù—å—é-–ô–æ—Ä–∫", "–õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å", "–ß–∏–∫–∞–≥–æ", "–õ–æ–Ω–¥–æ–Ω", "–ü–∞—Ä–∏–∂",
    "–ë–µ—Ä–ª–∏–Ω", "–†–∏–º", "–ú–∞–¥—Ä–∏–¥", "–¢–æ–∫–∏–æ", "–ü–µ–∫–∏–Ω",
    "–®–∞–Ω—Ö–∞–π", "–°–µ—É–ª", "–î–µ–ª–∏", "–ú—É–º–±–∞–∏", "–°–∞–Ω-–ü–∞—É–ª—É",
    "–ë—É—ç–Ω–æ—Å-–ê–π—Ä–µ—Å", "–ö–∞–∏—Ä", "–ú–µ—Ö–∏–∫–æ", "–°—Ç–∞–º–±—É–ª", "–î—É–±–∞–π",
    "–°–∏–¥–Ω–µ–π", "–¢–æ—Ä–æ–Ω—Ç–æ", "–í–∞–Ω–∫—É–≤–µ—Ä", "–ê–º—Å—Ç–µ—Ä–¥–∞–º", "–í–µ–Ω–∞",
    "–¶—é—Ä–∏—Ö", "–°—Ç–æ–∫–≥–æ–ª—å–º", "–•–µ–ª—å—Å–∏–Ω–∫–∏", "–û—Å–ª–æ", "–ö–æ–ø–µ–Ω–≥–∞–≥–µ–Ω",
    "–ë—Ä—é—Å—Å–µ–ª—å", "–ü—Ä–∞–≥–∞", "–í–∞—Ä—à–∞–≤–∞", "–ë—É–¥–∞–ø–µ—à—Ç", "–ê—Ñ–∏–Ω—ã",
    "–õ–∏—Å—Å–∞–±–æ–Ω", "–î—É–±–ª–∏–Ω", "–†–µ–π–∫—å—è–≤–∏–∫", "–ö–µ–π–ø—Ç–∞—É–Ω"
]

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {chat_id: {"city": "–ú–æ—Å–∫–≤–∞"}}
user_data = {}  # –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
@bot.message_handler(commands=['start'])
def start(message):
    chat_id = message.chat.id  # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —á–∞—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    user_data[chat_id] = user_data.get(chat_id, {})  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    bot.send_message(
        chat_id,
        "üå§ –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –ø–æ–≥–æ–¥—ã.\n"
        "1. –ù–∞–∂–º–∏—Ç–µ /city –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥.\n"
        "2. –ù–∞–∂–º–∏—Ç–µ /data ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å (–ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 4 –¥–Ω—è)."
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help ‚Äî —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
@bot.message_handler(commands=['help'])
def help_cmd(message):
    bot.send_message(
        message.chat.id,
        "üõ† –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:\n"
        "- /city ‚Äî –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞ (–≤–∫–ª—é—á–∞—è –ö—É—Ä–≥–∞–Ω)\n"
        "- /data ‚Äî –≤—ã–±—Ä–∞—Ç—å –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (—Å–µ–≥–æ–¥–Ω—è + 3 –¥–Ω—è)\n"
        "- –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç –ø–æ–≥–æ–¥—É –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å."
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /city ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≤—ã–±–æ—Ä–æ–º –≥–æ—Ä–æ–¥–∞
@bot.message_handler(commands=['city'])
def city_cmd(message):
    chat_id = message.chat.id
    user_data[chat_id] = user_data.get(chat_id, {})  # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç
    markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)  # –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
    for city in CITIES:
        markup.add(city)  # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥ –∫–∞–∫ –∫–Ω–æ–ø–∫—É
    bot.send_message(chat_id, "–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥:", reply_markup=markup)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /data ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–Ω—è (—Å–µ–≥–æ–¥–Ω—è + 3 –¥–Ω—è)
@bot.message_handler(commands=['data'])
def data_cmd(message):
    chat_id = message.chat.id
    if chat_id not in user_data or not user_data[chat_id].get('city'):  # –ü—Ä–æ–≤–µ—Ä–∫–∞: –≥–æ—Ä–æ–¥ —É–∂–µ –≤—ã–±—Ä–∞–Ω?
        bot.send_message(chat_id, "‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ —á–µ—Ä–µ–∑ /city.")
        return
    today = datetime.now().date()  # –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
    dates = [today + timedelta(days=i) for i in range(4)]  # –°–ø–∏—Å–æ–∫ –∏–∑ 4 –¥–∞—Ç: —Å–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞, –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞, —á–µ—Ä–µ–∑ 3 –¥–Ω—è
    markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
    for d in dates:
        day_name = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"][d.weekday()]  # –ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
        btn_text = f"{day_name} {d.strftime('%d.%m')}"  # –§–æ—Ä–º–∞—Ç: "–ü–Ω 18.01"
        markup.add(btn_text)
    bot.send_message(chat_id, "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å:", reply_markup=markup)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –õ–Æ–ë–û–ì–û —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–æ–∫)
@bot.message_handler(func=lambda m: True)
def handle_text(message):
    chat_id = message.chat.id
    text = message.text.strip()  # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞
    if text in CITIES:
        user_data[chat_id] = user_data.get(chat_id, {})
        user_data[chat_id]['city'] = text  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥
        bot.send_message(chat_id, f"‚úÖ –ì–æ—Ä–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: {text}. –¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏—Ç–µ /data.")
        return

    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –¥–∞—Ç—É (—Ñ–æ—Ä–º–∞—Ç: "–ü–Ω 24.11")
    if any(text.startswith(d) for d in ["–ü–Ω ", "–í—Ç ", "–°—Ä ", "–ß—Ç ", "–ü—Ç ", "–°–± ", "–í—Å "]):
        if chat_id not in user_data or not user_data[chat_id].get('city'):
            bot.send_message(chat_id, "‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ —á–µ—Ä–µ–∑ /city.")
            return
        try:
            date_str = text.split()[1]  # –ò–∑–≤–ª–µ–∫–∞–µ–º "24.11" –∏–∑ "–ü–Ω 24.11"
            day, month = map(int, date_str.split('.'))  # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –¥–µ–Ω—å –∏ –º–µ—Å—è—Ü
            today = datetime.now().date()
            year = today.year
            target_date = datetime(year, month, day).date()  # –°–æ–±–∏—Ä–∞–µ–º –¥–∞—Ç—É

            # –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –≥–æ–¥–∞ (–µ—Å–ª–∏ 31 –¥–µ–∫–∞–±—Ä—è –ø—Ä–∏ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ 1 —è–Ω–≤–∞—Ä—è)
            if target_date < today and (today - target_date).days > 300:
                target_date = datetime(year + 1, month, day).date()

            # –ü—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞—Ç–∞ –≤ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ (—Å–µ–≥–æ–¥–Ω—è + 3 –¥–Ω—è)?
            valid_dates = [today + timedelta(days=i) for i in range(4)]
            if target_date not in valid_dates:
                bot.send_message(chat_id, "‚ùå –≠—Ç–∞ –¥–∞—Ç–∞ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏.")
                return

            city = user_data[chat_id]['city']
            get_weather(bot, chat_id, city, target_date)  # –ü–æ–ª—É—á–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–≥–Ω–æ–∑
        except Exception as e:
            bot.send_message(chat_id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞—Ç—É. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏.")
        return

    # –õ—é–±–æ–µ –¥—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∞
    bot.send_message(
        chat_id,
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\n"
        "/city ‚Äî –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥\n"
        "/data ‚Äî –≤—ã–±—Ä–∞—Ç—å –¥–µ–Ω—å"
    )

# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã
def get_weather(bot, chat_id, city, date):
    url = "http://api.openweathermap.org/data/2.5/forecast"  #  –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π
    params = {
        'q': city,               # –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
        'appid': OPENWEATHER_API_KEY,  # –í–∞—à API-–∫–ª—é—á
        'units': 'metric',       # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ ¬∞C
        'lang': 'ru'             # –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≥–æ–¥—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
    }

    try:
        resp = requests.get(url, params=params, timeout=10)  # –ó–∞–ø—Ä–æ—Å —Å —Ç–∞–π–º–∞—É—Ç–æ–º 10 —Å–µ–∫
        if resp.status_code != 200:  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
            error_msg = resp.json().get('message', 'Unknown error')
            bot.send_message(chat_id, f"‚ùå –û—à–∏–±–∫–∞ OpenWeather: {error_msg}")
            return

        data = resp.json()  # –ü–∞—Ä—Å–∏–Ω–≥ JSON-–æ—Ç–≤–µ—Ç–∞
        best = None
        min_diff = 999
        # –ò—â–µ–º –ø—Ä–æ–≥–Ω–æ–∑, –±–ª–∏–∂–∞–π—à–∏–π –∫ 12:00 —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –¥–Ω—è
        for item in data['list']:
            dt = datetime.fromtimestamp(item['dt'])  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º timestamp –≤ datetime
            if dt.date() == date:
                diff = abs(dt.hour - 12)  # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –ø–æ–ª—É–¥–Ω—è
                if diff < min_diff:
                    min_diff = diff
                    best = item

        if not best:  # –ï—Å–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç
            bot.send_message(chat_id, "üå§ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–µ –Ω–∞–π–¥–µ–Ω.")
            return

        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
        temp = best['main']['temp']  # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
        desc = best['weather'][0]['description'].capitalize()  # –û–ø–∏—Å–∞–Ω–∏–µ (—Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã)
        hum = best['main']['humidity']  # –í–ª–∞–∂–Ω–æ—Å—Ç—å (%)
        wind = best['wind']['speed']  # –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ (–º/—Å)

        # –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞
        weekday_names = ["–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–≤—Ç–æ—Ä–Ω–∏–∫", "—Å—Ä–µ–¥–∞", "—á–µ—Ç–≤–µ—Ä–≥", "–ø—è—Ç–Ω–∏—Ü–∞", "—Å—É–±–±–æ—Ç–∞", "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"]
        weekday = weekday_names[date.weekday()]

        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º
        msg = (
            f"üå§ –ü–æ–≥–æ–¥–∞ –≤ {city} –Ω–∞ {weekday}, {date.strftime('%d.%m')}:\n"
            f"üå° {temp:.1f}¬∞C\n"
            f"‚òÅÔ∏è {desc}\n"
            f"üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å: {hum}%\n"
            f"üí® –í–µ—Ç–µ—Ä: {wind} –º/—Å"
        )
        bot.send_message(chat_id, msg)

    except Exception as e:
        bot.send_message(chat_id, f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≥–æ–¥—ã: {str(e)}")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == '__main__':
    print("üöÄ –£–¥–∞–ª—è–µ–º webhook –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞...")
    bot.remove_webhook()  # –£–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–π webhook (—á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª polling)
    time.sleep(1)  # –ü–∞—É–∑–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
    try:
        bot.polling(none_stop=True, timeout=30)  # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ long polling
    except Exception as e:
        print(f"üõë –û—à–∏–±–∫–∞: {e}")  # –í—ã–≤–æ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª—å

